<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="zdZMpUR-FZn3NtutmKmKzmPnZIswFsPGKLACq5jj918" />
    <title>VisionTube - Nex-gen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        /* Basic Styling */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a2e; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #a29bfe, #7c5cff); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #b1adff, #9174ff); }
        body { font-family: 'Inter', sans-serif; background-color: #0f0f1a; color: #e0e0e0; }
        .glassmorphism { background: rgba(26, 26, 46, 0.6); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(162, 155, 254, 0.2); border-radius: 1rem; }
        .gradient-text { background: linear-gradient(90deg, #a29bfe, #7c5cff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent; }

        /* Grid & Navbar Scrollbar Hiding */
        #video-grid::-webkit-scrollbar,
        #search-results-grid::-webkit-scrollbar,
        #recently-viewed-grid::-webkit-scrollbar,
        #playlist-videos-grid::-webkit-scrollbar,
        #desktop-nav-container::-webkit-scrollbar,
        #desktop-sidebar-container::-webkit-scrollbar { display: none; }

        #video-grid,
        #search-results-grid,
        #recently-viewed-grid,
        #playlist-videos-grid,
        #desktop-nav-container,
        #desktop-sidebar-container { -ms-overflow-style: none; scrollbar-width: none; }

        /* Mobile Sidebar */
        #mobile-sidebar { transition: transform 0.3s ease-in-out; }
        #mobile-sidebar.translate-x-full { transform: translateX(100%); }
        #mobile-sidebar.translate-x-0 { transform: translateX(0); }

        /* Loader */
        .loader { border: 4px solid #333; border-top: 4px solid #a29bfe; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        button:disabled .loader { width: 1.25rem; height: 1.25rem; border-width: 3px; }
        button:disabled { cursor: not-allowed; opacity: 0.7; }

        /* YouTube Player */
        #youtube-player-container { position: relative; width: 100%; padding-bottom: 56.25%; height: 0; overflow: hidden; background-color: #000; border-radius: 0.5rem; }
        #youtube-player-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }

        /* Video Card */
        .video-card:hover { transform: translateY(-5px) scale(1.03); box-shadow: 0 10px 20px rgba(124, 92, 255, 0.3); }
        .video-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }

        /* Video Description Link */
        #video-description a { color: #a29bfe; text-decoration: underline; }
        #video-description a:hover { color: #b1adff; }

        /* Fullscreen */
        .fullscreen { position: fixed !important; top: 0; left: 0; width: 100% !important; height: 100% !important; z-index: 10000; overflow: auto; background-color: #000; }
        #youtube-player-container.fullscreen { padding-bottom: 0; }
        @media screen and (orientation: landscape) { #youtube-player-container.fullscreen { width: 100vw; height: 100vh; } }

        /* Line Clamp */
        .line-clamp-1 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 1; }
        .line-clamp-2 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; }

        /* Modal Styles */
        .modal { transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal.hidden { opacity: 0; visibility: hidden; }
        .modal-content { transition: transform 0.3s ease; }
        .modal.hidden .modal-content { transform: scale(0.9); }

        /* Playlist Item Hover */
        .playlist-item:hover { background-color: rgba(162, 155, 254, 0.1); }

        /* Desktop Sidebar */
        #desktop-sidebar-container {
            position: fixed;
            top: 0;
            right: 0; /* Tetap di kanan */
            height: 100%;
            width: 240px; /* Sesuaikan lebar sidebar sesuai selera */
            background-color: #0f0f1a; /* Warna background sama kayak body */
            border-left: 1px solid rgba(162, 155, 254, 0.2); /* Tetap border kiri */
            box-shadow: -5px 0 10px rgba(0, 0, 0, 0.3); /* Tetap shadow kiri */
            z-index: 60; /* Biar di atas header */
            padding-top: 60px; /* Biar nggak ketutup header */
            transform: translateX(100%); /* Awalnya di luar layar, ke kanan */
            transition: transform 0.3s ease-in-out;
        }

        #desktop-sidebar-container.open {
            transform: translateX(0); /* Kalau class 'open' ditambahkan, baru muncul */
        }

        #desktop-sidebar-container nav {
            padding: 1rem;
        }

        #desktop-sidebar-container a {
            display: block;
            padding: 0.75rem 1rem;
            color: #e0e0e0;
            text-decoration: none;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease;
        }

        #desktop-sidebar-container a:hover {
            background-color: rgba(162, 155, 254, 0.1);
            color: #a29bfe;
        }

        #desktop-nav-container {
            display: flex; /* Biar bisa atur posisi tombol */
            justify-content: space-between; /* Tombol di kiri dan logo di tengah/kanan */
            align-items: center; /* Biar vertikal tengah */
        }

        #desktop-nav-container nav {
            display: none; /* Sembunyikan navigasi utama desktop */
        }

        #desktop-sidebar-toggle-button {
            display: flex; /* Selalu tampil di desktop */
            align-items: center;
            margin-right: auto; /* Biar ke kiri */
            padding: 0.5rem;
            background: none;
            border: none;
            color: #a29bfe;
            cursor: pointer;
            outline: none;
        }

        @media (max-width: 767px) { /* Tetap sembunyi di mode mobile */
            #desktop-sidebar-toggle-button {
                display: none !important;
            }
        }
    </style>
</head>
<body class="antialiased">

    <header class="fixed top-0 left-0 right-0 z-50 glassmorphism border-b border-purple-900/30 shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center">
                <button id="desktop-sidebar-toggle-button" class="flex items-center mr-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7" /></svg></button>
                <a href="#" onclick="navigateTo('home'); return false;" class="flex items-center space-x-2 cursor-pointer flex-shrink-0">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 gradient-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <div><h1 class="text-xl font-bold gradient-text">VisionTube</h1><p class="text-xs text-purple-300">Next-gen</p></div>
                </a>
            </div>
            <div class="hidden md:flex flex-grow max-w-xl mx-4">
                <form id="search-form-desktop" class="w-full flex">
                    <input type="search" id="search-input-desktop" placeholder="Cari video..." class="flex-grow px-4 py-2 rounded-l-lg bg-gray-800/50 border border-purple-700/50 focus:outline-none focus:ring-2 focus:ring-purple-500 text-white placeholder-gray-400">
                    <button type="submit" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-r-lg hover:from-purple-700 hover:to-indigo-700 transition duration-200"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg></button>
                </form>
            </div>
            <div id="desktop-nav-container" class="hidden md:flex flex-1 min-w-0 justify-end ml-4">
                <nav class="flex items-center space-x-6 flex-shrink-0">
                    <a href="#" onclick="navigateTo('home'); return false;" class="text-purple-300 hover:text-white transition duration-200 whitespace-nowrap">Trending</a>
                    <a href="#" onclick="navigateTo('recently-viewed'); return false;" class="text-purple-300 hover:text-white transition duration-200 whitespace-nowrap">Terakhir Dilihat</a>
                    <a href="#" onclick="navigateTo('playlists'); return false;" class="text-purple-300 hover:text-white transition duration-200 whitespace-nowrap">Playlist Saya</a>
                    <a href="#" onclick="navigateTo('about'); return false;" class="text-purple-300 hover:text-white transition duration-200 whitespace-nowrap">Tentang</a>
                </nav>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-purple-300 hover:text-white focus:outline-none ml-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg></button>
        </div>
    </header>

    <aside id="desktop-sidebar-container" class="md:block hidden">
        <nav>
            <a href="#" onclick="navigateTo('home'); return false;">Trending</a>
            <a href="#" onclick="navigateTo('recently-viewed'); return false;">Terakhir Dilihat</a>
            <a href="#" onclick="navigateTo('playlists'); return false;">Playlist Saya</a>
            <a href="#" onclick="navigateTo('about'); return false;">Tentang</a>
        </nav>
    </aside>

    <aside id="mobile-sidebar" class="fixed top-0 right-0 h-full w-64 glassmorphism border-l border-purple-900/30 shadow-lg z-40 pt-20 px-4 transform translate-x-full md:hidden">
        <form id="search-form-mobile" class="w-full mb-6">
            <input type="search" id="search-input-mobile" placeholder="Cari video..." class="w-full px-3 py-2 rounded-md mb-2 bg-gray-800/70 border border-purple-700/50 focus:outline-none focus:ring-1 focus:ring-purple-500 text-white placeholder-gray-400 text-sm">
            <button type="submit" class="w-full px-3 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-md hover:from-purple-700 hover:to-indigo-700 transition duration-200 flex items-center justify-center text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                Cari
            </button>
        </form>
        <nav class="flex flex-col space-y-4">
            <a href="#" onclick="navigateTo('home'); closeSidebar(); return false;" class="text-purple-200 hover:text-white transition duration-200 py-2 px-2 rounded hover:bg-purple-800/30">Trending</a>
            <a href="#" onclick="navigateTo('recently-viewed'); closeSidebar(); return false;" class="text-purple-200 hover:text-white transition duration-200 py-2 px-2 rounded hover:bg-purple-800/30">Terakhir Dilihat</a>
            <a href="#" onclick="navigateTo('playlists'); closeSidebar(); return false;" class="text-purple-200 hover:text-white transition duration-200 py-2 px-2 rounded hover:bg-purple-800/30">Playlist Saya</a>
            <a href="#" onclick="navigateTo('about'); closeSidebar(); return false;" class="text-purple-200 hover:text-white transition duration-200 py-2 px-2 rounded hover:bg-purple-800/30">Tentang</a>
        </nav>
    </aside>
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-30 hidden md:hidden" onclick="closeSidebar()"></div>

    <main id="main-content" class="container mx-auto px-4 pt-24 pb-8">
        <div id="trending-view">
            <h2 class="text-2xl font-semibold mb-6 gradient-text">Lagi Trending di Indonesia üî•</h2>
            <div id="video-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-6">
                 <div id="trending-loading-placeholder" class="col-span-full text-center py-10"><div class="loader inline-block"></div><p class="mt-3 text-purple-300">Lagi ngambil video trending...</p></div>
            </div>
            <div id="trending-load-more-container" class="text-center mt-8 hidden">
                 <button id="trending-load-more-button" class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-6 py-2 rounded-lg hover:from-purple-700 hover:to-indigo-700 transition duration-200 disabled:opacity-70 disabled:cursor-not-allowed">Muat Lebih Banyak</button>
             </div>
        </div>
        <div id="watch-view" class="hidden">
             <div class="flex flex-col lg:flex-row gap-6">
                <div class="lg:w-2/3">
                    <div id="youtube-player-container" class="mb-4 glassmorphism p-1 aspect-video bg-black rounded-lg shadow-lg"><div id="youtube-player"></div></div>
                    <div id="video-details" class="glassmorphism p-4 rounded-lg">
                        <div class="flex justify-between items-start mb-2">
                            <h1 id="video-title" class="text-xl md:text-2xl font-semibold text-white flex-1 mr-4">Judul Video Loading...</h1>
                            <button id="save-video-button" onclick="openSaveVideoModal()" class="flex-shrink-0 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white px-3 py-1.5 rounded-lg text-sm font-medium flex items-center space-x-1.5 transition duration-200" title="Simpan ke Playlist">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z" /></svg>
                                <span>Simpan</span>
                            </button>
                        </div>
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3 text-sm text-purple-300"><p id="video-uploader" class="mb-1 sm:mb-0">Channel Loading...</p><p id="video-stats">Views Loading...</p></div>
                        <hr class="border-purple-800/50 my-3">
                        <p id="video-description" class="text-sm text-gray-300 whitespace-pre-wrap max-h-60 overflow-y-auto">Deskripsi loading...</p>
                    </div>
                </div>
                 <div class="lg:w-1/3">
                    <h3 class="text-lg font-semibold mb-4 gradient-text">Video Terkait</h3>
                    <div id="related-videos" class="space-y-3"><p class="text-sm text-gray-400">Fitur video terkait belum diimplementasikan.</p></div>
                 </div>
             </div>
        </div>
        <div id="search-view" class="hidden">
            <h2 class="text-2xl font-semibold mb-6">Hasil Pencarian untuk: "<span id="search-query-display" class="gradient-text"></span>"</h2>
            <div id="search-results-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-6"></div>
             <div id="search-loading-indicator" class="text-center py-6 hidden"><div class="loader inline-block"></div><p class="mt-2 text-purple-300">Memuat lebih banyak video...</p></div>
             <p id="search-no-results" class="text-center text-gray-400 py-6 hidden">Yah, nggak nemu hasil buat pencarian ini üò•.</p>
        </div>
        <div id="recently-viewed-view" class="hidden">
            <h2 class="text-2xl font-semibold mb-6 gradient-text">Terakhir Dilihat ‚è±Ô∏è</h2>
            <div id="recently-viewed-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-6"></div>
            <p id="recently-viewed-empty" class="text-center text-gray-400 py-10 hidden">Belum ada video yang ditonton nih. Yuk, mulai jelajah! üöÄ</p>
        </div>
        <div id="playlists-view" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold gradient-text">Playlist Saya üìö</h2>
                <button onclick="openCreatePlaylistModal()" class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center space-x-1.5 transition duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" /></svg>
                    <span>Buat Playlist Baru</span>
                </button>
            </div>
            <div id="playlists-list" class="space-y-4"></div>
            <p id="playlists-empty" class="text-center text-gray-400 py-10 hidden">Kamu belum punya playlist. Yuk, buat playlist pertamamu! ‚ú®</p>
        </div>
        <div id="playlist-detail-view" class="hidden">
            <div class="flex items-center mb-6">
                <button onclick="navigateTo('playlists')" class="text-purple-300 hover:text-white mr-3 p-1 rounded-full hover:bg-purple-800/30 transition duration-200" title="Kembali ke Playlist Saya">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
                </button>
                <h2 id="playlist-detail-name" class="text-2xl font-semibold gradient-text">Nama Playlist Loading...</h2>
            </div>
            <div id="playlist-videos-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-6"></div>
            <p id="playlist-videos-empty" class="text-center text-gray-400 py-10 hidden">Playlist ini masih kosong. Tambahkan video dari halaman nonton! üëÄ</p>
        </div>
        <div id="about-view" class="hidden glassmorphism p-6 rounded-lg max-w-3xl mx-auto">
             <h2 class="text-2xl font-semibold mb-4 gradient-text">Tentang VisionTube (YT API Mode) ‚ú®</h2>
            <p class="mb-4 text-gray-300">Hai kamu! üëã Selamat datang di VisionTube, platform nonton video YouTube dengan tampilan kekinian dan fitur-fitur canggih! Dibuat khusus buat kamu yang pengen pengalaman nonton yang beda dari yang lain! üòâ</p>
            <p class="mb-4 text-gray-300">Intip yuk, fitur-fitur keren yang bisa kamu nikmatin di VisionTube:</p>
            <ul class="list-disc list-inside mb-4 text-gray-300 space-y-2">
                <li><strong class="text-purple-300">Interface Next-Gen</strong> üòé: Tampilan VisionTube ini super stylish dan intuitif banget! Kamu bakal betah deh, navigasinya gampang, semua fitur ada di tempat yang pas! ‚ú®</li>
                <li><strong class="text-purple-300">Trending Langsung (ID)</strong> üî•: Pengen tau video apa aja yang lagi viral di Indonesia? Tenang! Di VisionTube, kamu bisa langsung liat daftar video trending terbaru dan terpopuler! Jadi, nggak bakal ketinggalan deh sama video yang lagi rame! üáÆüá©</li>
                <li><strong class="text-purple-300">Pencarian YouTube</strong> üîç: Nyari video favorit atau video yang lagi kamu butuhin? Gampang banget! Tinggal ketik kata kuncinya di kolom pencarian, dan VisionTube bakal langsung nemuin video yang kamu cari dari seluruh penjuru YouTube! Cepet dan akurat! üëç</li>
                <li><strong class="text-purple-300">Terakhir Dilihat</strong> ‚è±Ô∏è: Sering lupa video apa aja yang udah kamu tonton? Jangan khawatir! VisionTube otomatis nyimpen riwayat video yang udah kamu tonton. Jadi, kamu bisa dengan mudah balik lagi buat nonton ulang atau lanjutin nanti! Praktis kan? üòâ</li>
                <li><strong class="text-purple-300">Playlist Saya</strong> üìö: Bikin playlist video favorit kamu sendiri! Kamu bisa kelompokin video-video berdasarkan mood, genre, atau topik yang kamu suka. Jadi, koleksi video kamu jadi lebih rapi dan gampang diakses kapan aja kamu mau! ü§©</li>
                <li><strong class="text-purple-300">Player Resmi</strong> ‚ñ∂Ô∏è: VisionTube menggunakan YouTube player resmi, jadi kamu bisa nikmatin semua fitur playback yang ada di YouTube, mulai dari kualitas video, subtitle, sampai mode layar penuh. Pengalaman nonton yang maksimal deh! üíØ</li>
                <li><strong class="text-purple-300">Hemat API (Trending)</strong> üí°: Kita pinter loh! Untuk fitur trending, VisionTube menyimpan data sementara, jadi nggak perlu terus-terusan minta data baru ke YouTube. Ini bikin penggunaan API jadi lebih efisien dan website tetep ngebut! üí®</li>
                <li><strong class="text-purple-300">Infinite Scroll (Search)</strong> üñ±Ô∏è: Males mencet tombol "Muat Lebih Banyak" terus? Di halaman pencarian, VisionTube bakal otomatis ngeload hasil pencarian lainnya saat kamu scroll ke bawah. Jadi, kamu bisa terus nemuin video-video baru tanpa gangguan! Asiiiik! üéâ</li>
                <li><strong class="text-purple-300">Nonton Tanpa Iklan</strong> ‚ú®: Asiiiik! Di VisionTube, kamu bisa nonton video YouTube favoritmu tanpa gangguan iklan! Dijamin pengalaman nonton jadi makin seru dan nggak bikin bete! ü•≥</li>
            </ul>
            <p class="mb-4 text-gray-300">Oh iya, karena VisionTube ini menggunakan API resmi dari YouTube...</p>
            <p class="text-red-400 text-sm font-semibold">PERHATIAN: API Key YouTube itu ada batas penggunaannya (kuota). Jadi, kalau tiba-tiba ada error atau fitur nggak berfungsi, kemungkinan besar kuotanya lagi abis. Tenang aja, kuota API ini biasanya direset setiap 24 jam sekali pada pukul 14:00 WIB. Jadi, coba lagi nanti ya! üôè</p>
            <p class="mb-4 text-gray-300">Gimana? Keren kan fitur-fitur VisionTube? Yuk, langsung aja cobain dan rasain sendiri pengalaman nonton YouTube yang lebih seru! üòÑ</p>
        </div>

        <div id="loading-indicator" class="fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] hidden"><div class="loader"></div></div>
        <div id="notification-message" class="fixed bottom-4 right-4 text-white p-4 rounded-lg shadow-lg z-[9998] hidden max-w-sm glassmorphism border">
            <strong id="notification-title" class="font-bold block mb-1"></strong>
            <p id="notification-text" class="text-sm"></p>
            <button onclick="document.getElementById('notification-message').classList.add('hidden')" class="absolute top-2 right-2 text-gray-200 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
            </button>
        </div>

        <div id="save-video-modal" class="modal hidden fixed inset-0 bg-black/70 flex items-center justify-center z-[10000]">
            <div class="modal-content glassmorphism p-6 rounded-lg max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold gradient-text">Simpan ke Playlist</h3><button onclick="closeSaveVideoModal()" class="text-gray-400 hover:text-white">√ó</button></div>
                <div id="save-modal-video-info" class="mb-4 p-3 bg-purple-900/20 rounded-lg flex items-center space-x-3"><img id="save-modal-thumbnail" src="https://placehold.co/60x34/0f0f1a/7c5cff?text=Thumb" alt="Video Thumbnail" class="w-16 h-9 object-cover rounded flex-shrink-0"><div><p id="save-modal-title" class="text-sm font-medium text-white line-clamp-1">Judul Video...</p><p id="save-modal-channel" class="text-xs text-purple-300 line-clamp-1">Channel...</p></div></div>
                <form id="save-video-form">
                    <p class="text-sm text-gray-300 mb-2">Pilih playlist:</p><div id="save-modal-playlist-list" class="space-y-2 max-h-40 overflow-y-auto mb-4 pr-2"><p class="text-xs text-gray-400">Loading playlist...</p></div>
                    <div class="border-t border-purple-800/50 pt-4"><label for="new-playlist-name-modal" class="text-sm text-gray-300 block mb-1">Atau buat playlist baru:</label><div class="flex space-x-2"><input type="text" id="new-playlist-name-modal" placeholder="Nama Playlist Baru..." class="flex-grow px-3 py-1.5 rounded-lg bg-gray-800/50 border border-purple-700/50 focus:outline-none focus:ring-1 focus:ring-purple-500 text-white placeholder-gray-400 text-sm"><button type="button" onclick="createNewPlaylistFromModal()" class="bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white px-3 py-1.5 rounded-lg text-sm flex-shrink-0">Buat</button></div></div>
                    <div class="mt-6 flex justify-end space-x-3"><button type="button" onclick="closeSaveVideoModal()" class="px-4 py-1.5 rounded-lg bg-gray-600/50 hover:bg-gray-500/50 text-gray-200 text-sm transition duration-200">Batal</button><button type="submit" class="px-4 py-1.5 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white text-sm transition duration-200">Selesai</button></div>
                </form>
            </div>
        </div>
        <div id="create-playlist-modal" class="modal hidden fixed inset-0 bg-black/70 flex items-center justify-center z-[10000]">
            <div class="modal-content glassmorphism p-6 rounded-lg max-w-sm w-full mx-4">
                <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold gradient-text">Buat Playlist Baru</h3><button onclick="closeCreatePlaylistModal()" class="text-gray-400 hover:text-white">√ó</button></div>
                <form id="create-playlist-form">
                    <label for="new-playlist-name-main" class="text-sm text-gray-300 block mb-1">Nama Playlist:</label><input type="text" id="new-playlist-name-main" required placeholder="Contoh: Musik Favorit üé∂" class="w-full px-3 py-1.5 rounded-lg bg-gray-800/50 border border-purple-700/50 focus:outline-none focus:ring-1 focus:ring-purple-500 text-white placeholder-gray-400 text-sm mb-4">
                    <div class="flex justify-end space-x-3"><button type="button" onclick="closeCreatePlaylistModal()" class="px-4 py-1.5 rounded-lg bg-gray-600/50 hover:bg-gray-500/50 text-gray-200 text-sm transition duration-200">Batal</button><button type="submit" class="px-4 py-1.5 rounded-lg bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white text-sm transition duration-200">Buat Playlist</button></div>
                </form>
            </div>
        </div>
        <div id="rename-playlist-modal" class="modal hidden fixed inset-0 bg-black/70 flex items-center justify-center z-[10000]">
            <div class="modal-content glassmorphism p-6 rounded-lg max-w-sm w-full mx-4">
                 <div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold gradient-text">Ubah Nama Playlist</h3><button onclick="closeRenamePlaylistModal()" class="text-gray-400 hover:text-white">√ó</button></div>
                <form id="rename-playlist-form">
                    <input type="hidden" id="rename-playlist-id"><label for="rename-playlist-name" class="text-sm text-gray-300 block mb-1">Nama Baru:</label><input type="text" id="rename-playlist-name" required class="w-full px-3 py-1.5 rounded-lg bg-gray-800/50 border border-purple-700/50 focus:outline-none focus:ring-1 focus:ring-purple-500 text-white placeholder-gray-400 text-sm mb-4">
                    <div class="flex justify-end space-x-3"><button type="button" onclick="closeRenamePlaylistModal()" class="px-4 py-1.5 rounded-lg bg-gray-600/50 hover:bg-gray-500/50 text-gray-200 text-sm transition duration-200">Batal</button><button type="submit" class="px-4 py-1.5 rounded-lg bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white text-sm transition duration-200">Simpan Perubahan</button></div>
                </form>
            </div>
        </div>

    <script>
        // --- Configuration ---
        const YOUTUBE_API_KEY = 'AIzaSyBVBHpsUwOFOUX69sW33l4uZq51Iyz90kE'; // Ganti API Key
        const YOUTUBE_API_BASE_URL = 'https://www.googleapis.com/youtube/v3';
        const TRENDING_MAX_RESULTS = 20;
        const SEARCH_MAX_RESULTS = 20;
        const TRENDING_CACHE_DURATION = 5 * 60 * 1000; // 5 menit
        const RECENTLY_VIEWED_STORAGE_KEY = 'visiontube_recently_viewed';
        const MAX_RECENTLY_VIEWED = 24;
        const PLAYLISTS_STORAGE_KEY = 'visiontube_playlists';

        // --- State Variables ---
        let currentView = 'home';
        let currentVideoId = null;
        let currentVideoDataForSave = null;
        let currentPlaylistId = null;
        let currentSearchQuery = '';
        let currentSearchPageToken = null;
        let currentTrendingPageToken = null;
        let isLoadingSearch = false;
        let isLoadingTrending = false;
        let ytPlayer = null;
        let videoIdToLoad = null;
        let cachedTrendingData = null;
        let trendingCacheTimestamp = 0;
        let isFullscreen = false;

        // --- DOM Elements ---
        // (References remain largely the same, adding notification elements)
        const notificationMessage = document.getElementById('notification-message'); // Unified notification element
        const notificationTitle = document.getElementById('notification-title'); // Title element inside notification
        const notificationText = document.getElementById('notification-text'); // Text element inside notification
        // ... other DOM element references ...
        const mainContent = document.getElementById('main-content');
        const trendingView = document.getElementById('trending-view');
        const watchView = document.getElementById('watch-view');
        const searchView = document.getElementById('search-view');
        const aboutView = document.getElementById('about-view');
        const recentlyViewedView = document.getElementById('recently-viewed-view');
        const playlistsView = document.getElementById('playlists-view');
        const playlistDetailView = document.getElementById('playlist-detail-view');
        const videoGrid = document.getElementById('video-grid');
        const trendingLoadingPlaceholder = document.getElementById('trending-loading-placeholder');
        const trendingLoadMoreContainer = document.getElementById('trending-load-more-container');
        const trendingLoadMoreButton = document.getElementById('trending-load-more-button');
        const searchResultsGrid = document.getElementById('search-results-grid');
        const searchLoadingIndicator = document.getElementById('search-loading-indicator');
        const searchNoResults = document.getElementById('search-no-results');
        const recentlyViewedGrid = document.getElementById('recently-viewed-grid');
        const recentlyViewedEmpty = document.getElementById('recently-viewed-empty');
        const playlistsList = document.getElementById('playlists-list');
        const playlistsEmpty = document.getElementById('playlists-empty');
        const playlistDetailName = document.getElementById('playlist-detail-name');
        const playlistVideosGrid = document.getElementById('playlist-videos-grid');
        const playlistVideosEmpty = document.getElementById('playlist-videos-empty');
        const youtubePlayerContainer = document.getElementById('youtube-player-container');
        const youtubePlayerDiv = document.getElementById('youtube-player');
        const videoTitle = document.getElementById('video-title');
        const videoUploader = document.getElementById('video-uploader');
        const videoStats = document.getElementById('video-stats');
        const videoDescription = document.getElementById('video-description');
        const saveVideoButton = document.getElementById('save-video-button');
        const loadingIndicator = document.getElementById('loading-indicator');
        const mobileSidebar = document.getElementById('mobile-sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const searchFormDesktop = document.getElementById('search-form-desktop');
        const searchInputDesktop = document.getElementById('search-input-desktop');
        const searchFormMobile = document.getElementById('search-form-mobile');
        const searchInputMobile = document.getElementById('search-input-mobile');
        const searchQueryDisplay = document.getElementById('search-query-display');
        const saveVideoModal = document.getElementById('save-video-modal');
        const saveModalPlaylistList = document.getElementById('save-modal-playlist-list');
        const saveModalThumbnail = document.getElementById('save-modal-thumbnail');
        const saveModalTitle = document.getElementById('save-modal-title');
        const saveModalChannel = document.getElementById('save-modal-channel');
        const saveVideoForm = document.getElementById('save-video-form');
        const newPlaylistNameModalInput = document.getElementById('new-playlist-name-modal');
        const createPlaylistModal = document.getElementById('create-playlist-modal');
        const createPlaylistForm = document.getElementById('create-playlist-form');
        const newPlaylistNameMainInput = document.getElementById('new-playlist-name-main');
        const renamePlaylistModal = document.getElementById('rename-playlist-modal');
        const renamePlaylistForm = document.getElementById('rename-playlist-form');
        const renamePlaylistIdInput = document.getElementById('rename-playlist-id');
        const renamePlaylistNameInput = document.getElementById('rename-playlist-name');
        const desktopSidebarContainer = document.getElementById('desktop-sidebar-container');
        const desktopSidebarToggleButton = document.getElementById('desktop-sidebar-toggle-button');
        const desktopNavContainer = document.getElementById('desktop-nav-container');


        // --- YouTube IFrame Player API Functions ---
        // (Unchanged from previous version)
        function onYouTubeIframeAPIReady() { console.log("YouTube IFrame API Ready."); if (videoIdToLoad) { createPlayer(videoIdToLoad); } }
        function createPlayer(videoId) { console.log("Creating player:", videoId); if (ytPlayer && typeof ytPlayer.destroy === 'function') { try { ytPlayer.destroy(); } catch (e) { console.warn("Error destroying player:", e); } ytPlayer = null; } ytPlayer = new YT.Player('youtube-player', { height: '100%', width: '100%', videoId: videoId, playerVars: { 'playsinline': 1, 'autoplay': 1 }, events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange, 'onError': onPlayerError } }); }
        function onPlayerReady(event) { console.log("Player Ready."); if (videoIdToLoad && event.target && typeof event.target.loadVideoById === 'function') { console.log("Loading queued video:", videoIdToLoad); event.target.loadVideoById(videoIdToLoad); videoIdToLoad = null; } }
        function onPlayerStateChange(event) { /* State change handling */ }
        function onPlayerError(event) { console.error("Player Error:", event.data); let msg = `Player Error: Kode ${event.data}.`; /* ... error mapping ... */ showError(msg + " Video mungkin dibatasi."); }
        function loadVideoIntoPlayer(videoId) { if (!videoId) return; currentVideoId = videoId; console.log("Loading video:", videoId); if (typeof YT === 'undefined' || !YT.Player) { console.log("API not ready, queuing:", videoId); videoIdToLoad = videoId; return; } if (ytPlayer && typeof ytPlayer.loadVideoById === 'function') { try { ytPlayer.loadVideoById(videoId); } catch (e) { console.error("Error loading video, recreating:", e); createPlayer(videoId); } } else { console.log("Player invalid, creating:", videoId); createPlayer(videoId); } }

        // --- Recently Viewed Functions ---
        // (Unchanged from previous version)
        function getRecentlyViewed() { try { const s = localStorage.getItem(RECENTLY_VIEWED_STORAGE_KEY); return s ? JSON.parse(s) : []; } catch (e) { console.error(e); return []; } }
        function saveRecentlyViewed(v) { try { localStorage.setItem(RECENTLY_VIEWED_STORAGE_KEY, JSON.stringify(v)); } catch (e) { console.error(e); showError("Gagal simpan riwayat."); } }
        function addRecentlyViewed(vd) { if (!vd || !vd.videoId) return; console.log("Adding recent:", vd.videoId); let v = getRecentlyViewed(); v = v.filter(i => i.videoId !== vd.videoId); v.unshift(vd); v = v.slice(0, MAX_RECENTLY_VIEWED); saveRecentlyViewed(v); }
        function loadRecentlyViewed() { console.log("Loading recent..."); const v = getRecentlyViewed(); recentlyViewedGrid.innerHTML = ''; if (v.length === 0) { recentlyViewedEmpty.classList.remove('hidden'); recentlyViewedGrid.classList.add('hidden'); } else { recentlyViewedEmpty.classList.add('hidden'); recentlyViewedGrid.classList.remove('hidden'); v.forEach(i => recentlyViewedGrid.appendChild(createRecentlyViewedCard(i))); } console.log("Loaded recent:", v.length); }

        // --- Playlist Functions ---
        // (Unchanged logic, just using updated notification functions)
        function getPlaylists() { try { const s = localStorage.getItem(PLAYLISTS_STORAGE_KEY); return s ? JSON.parse(s) : {}; } catch (e) { console.error(e); return {}; } }
        function savePlaylists(p) { try { localStorage.setItem(PLAYLISTS_STORAGE_KEY, JSON.stringify(p)); } catch (e) { console.error(e); showError("Gagal simpan playlist."); } }
        function createPlaylist(name) { const p = getPlaylists(); const id = `pl_${Date.now()}_${Math.random().toString(36).substring(2, 7)}`; const tName = name.trim(); if (!tName) { showError("Nama playlist kosong!"); return null; } const exists = Object.values(p).some(i => i.name.toLowerCase() === tName.toLowerCase()); if (exists) { showError(`Playlist "${tName}" sudah ada!`); return null; } p[id] = { id: id, name: tName, createdAt: Date.now(), videos: [] }; savePlaylists(p); console.log("Playlist created:", id, tName); return id; }
        function renamePlaylist(id, newName) { const p = getPlaylists(); const tName = newName.trim(); if (!tName) { showError("Nama baru kosong!"); return false; } if (p[id]) { const exists = Object.values(p).some(i => i.id !== id && i.name.toLowerCase() === tName.toLowerCase()); if (exists) { showError(`Nama "${tName}" sudah dipakai!`); return false; } p[id].name = tName; savePlaylists(p); console.log("Playlist renamed:", id, tName); return true; } else { showError("Playlist tak ditemukan."); return false; } }
        function deletePlaylist(id) { const p = getPlaylists(); if (p[id]) { if (confirm(`Yakin hapus playlist "${p[id].name}"?`)) { delete p[id]; savePlaylists(p); console.log("Playlist deleted:", id); if (currentView === 'playlists') loadPlaylists(); showSuccessMessage("Playlist berhasil dihapus."); } } else { showError("Playlist tak ditemukan."); } }
        function addVideoToPlaylists(ids, vd) { if (!vd || !vd.videoId) { showError("Data video tak valid."); return; } if (!ids || ids.length === 0) { showError("Pilih playlist tujuan."); return; } const p = getPlaylists(); let count = 0; const vta = { ...vd, addedAt: Date.now() }; ids.forEach(id => { if (p[id]) { const exists = p[id].videos.some(v => v.videoId === vd.videoId); if (!exists) { p[id].videos.unshift(vta); count++; } } }); if (count > 0) { savePlaylists(p); console.log(`Video added to ${count} playlist(s).`); showSuccessMessage(`Video ditambah ke ${count} playlist! ‚ú®`); } else { showError("Video sudah ada di playlist terpilih."); } closeSaveVideoModal(); }
        function removeVideoFromPlaylist(plId, vId) { const p = getPlaylists(); if (p[plId]) { const len = p[plId].videos.length; p[plId].videos = p[plId].videos.filter(v => v.videoId !== vId); if (p[plId].videos.length < len) { savePlaylists(p); console.log(`Video ${vId} removed from ${plId}`); if (currentView === 'playlist-detail' && currentPlaylistId === plId) loadPlaylistDetails(plId); showSuccessMessage("Video dihapus dari playlist."); } } else { showError("Playlist tak ditemukan."); } }
        function loadPlaylists() { console.log("Loading playlists..."); const p = getPlaylists(); const arr = Object.values(p).sort((a, b) => b.createdAt - a.createdAt); playlistsList.innerHTML = ''; if (arr.length === 0) { playlistsEmpty.classList.remove('hidden'); playlistsList.classList.add('hidden'); } else { playlistsEmpty.classList.add('hidden'); playlistsList.classList.remove('hidden'); arr.forEach(i => playlistsList.appendChild(createPlaylistItem(i))); } }
        function loadPlaylistDetails(id) { console.log("Loading playlist details:", id); const p = getPlaylists(); const pl = p[id]; if (!pl) { showError("Playlist tak ditemukan!"); navigateTo('playlists'); return; } currentPlaylistId = id; playlistDetailName.textContent = pl.name; playlistVideosGrid.innerHTML = ''; if (pl.videos.length === 0) { playlistVideosEmpty.classList.remove('hidden'); playlistVideosGrid.classList.add('hidden'); } else { playlistVideosEmpty.classList.add('hidden'); playlistVideosGrid.classList.remove('hidden'); const sorted = [...pl.videos].sort((a, b) => b.addedAt - a.addedAt); sorted.forEach(v => playlistVideosGrid.appendChild(createPlaylistVideoCard(v, id))); } }

        // --- API Functions ---
        // (Unchanged from previous version)
        async function fetchFromYouTubeAPI(endpoint, params) { const url = new URL(`${YOUTUBE_API_BASE_URL}${endpoint}`); params.key = YOUTUBE_API_KEY; Object.keys(params).forEach(key => { if (params[key] !== null && params[key] !== undefined) { url.searchParams.append(key, params[key]); } }); console.log(`Workspaceing: ${endpoint}`, params); const isInitial = (endpoint === '/videos' && params.id) || (endpoint === '/search' && !params.pageToken) || (endpoint === '/videos' && params.chart === 'mostPopular' && !params.pageToken); if (isInitial) showLoading(); try { const r = await fetch(url.toString()); const d = await r.json(); if (!r.ok) { let msg = `API Error (${r.status})`; if (d.error && d.error.message) { msg += `: ${d.error.message}`; if (d.error.errors && d.error.errors.some(e => e.reason === 'quotaExceeded')) msg = "Kuota API habis! üíÄ Coba lagi besok."; } else msg += `: ${r.statusText || 'Unknown'}`; throw new Error(msg); } if (isInitial) hideLoading(); return d; } catch (e) { console.error(`API Fetch Error (${endpoint}):`, e); showError(`${e.message}`); hideLoading(); if (endpoint === '/videos' && params.chart === 'mostPopular') { trendingLoadingPlaceholder.classList.add('hidden'); isLoadingTrending = false; if(trendingLoadMoreButton) { trendingLoadMoreButton.disabled = false; trendingLoadMoreButton.innerHTML = 'Muat Lebih Banyak'; } } else if (endpoint === '/search') { searchLoadingIndicator.classList.add('hidden'); isLoadingSearch = false; } return null; } }
        async function loadTrendingVideos(pageToken = null, forceRefresh = false) { if (!pageToken && !forceRefresh && cachedTrendingData && (Date.now() - trendingCacheTimestamp < TRENDING_CACHE_DURATION)) { console.log("Using cached trending."); videoGrid.innerHTML = ''; cachedTrendingData.items.forEach(i => videoGrid.appendChild(createVideoCard(i))); currentTrendingPageToken = cachedTrendingData.nextPageToken; trendingLoadMoreContainer.classList.toggle('hidden', !currentTrendingPageToken); trendingLoadingPlaceholder.classList.add('hidden'); return; } if (isLoadingTrending) return; isLoadingTrending = true; if (!pageToken) { videoGrid.innerHTML = ''; trendingLoadingPlaceholder.classList.remove('hidden'); trendingLoadMoreContainer.classList.add('hidden'); } else { trendingLoadMoreButton.innerHTML = '<div class="loader inline-block w-5 h-5 border-3"></div>'; trendingLoadMoreButton.disabled = true; } const params = { part: 'snippet,contentDetails,statistics', chart: 'mostPopular', regionCode: 'ID', maxResults: TRENDING_MAX_RESULTS, pageToken: pageToken }; console.log("Fetching trending...", params); const data = await fetchFromYouTubeAPI('/videos', params); trendingLoadingPlaceholder.classList.add('hidden'); if (pageToken && trendingLoadMoreButton) { trendingLoadMoreButton.innerHTML = 'Muat Lebih Banyak'; trendingLoadMoreButton.disabled = false; } if (data && data.items && Array.isArray(data.items)) { if (!pageToken) { console.log("Caching trending."); cachedTrendingData = { items: [...data.items], nextPageToken: data.nextPageToken }; trendingCacheTimestamp = Date.now(); videoGrid.innerHTML = ''; } data.items.forEach(i => videoGrid.appendChild(createVideoCard(i))); currentTrendingPageToken = data.nextPageToken; trendingLoadMoreContainer.classList.toggle('hidden', !currentTrendingPageToken); if (data.items.length === 0 && !pageToken) { videoGrid.innerHTML = '<p class="text-center text-gray-400 col-span-full py-5">Trending kosong.</p>'; cachedTrendingData = null; } } else if (!pageToken) { videoGrid.innerHTML = '<p class="text-center text-red-400 col-span-full py-5">Gagal load trending.</p>'; cachedTrendingData = null; } isLoadingTrending = false; }
        async function loadVideoDetails(videoId) { videoTitle.textContent = 'Loading...'; videoUploader.textContent = 'Loading...'; videoStats.textContent = 'Loading...'; videoDescription.textContent = 'Loading...'; currentVideoDataForSave = null; const params = { part: 'snippet,statistics,contentDetails', id: videoId }; const data = await fetchFromYouTubeAPI('/videos', params); if (data && data.items && data.items.length > 0) { const v = data.items[0]; const s = v.snippet; const st = v.statistics; const t = s.title || 'N/A'; const c = s.channelTitle || 'N/A'; const th = s.thumbnails?.medium?.url || s.thumbnails?.default?.url; videoTitle.textContent = t; videoUploader.textContent = c ? `Oleh: ${c}` : 'N/A'; const vt = st?.viewCount ? formatViews(st.viewCount) : 'N/A'; const p = s.publishedAt ? timeAgo(s.publishedAt) : '?'; videoStats.textContent = `${vt} views ‚Ä¢ ${p}`; const dHtml = (s.description || 'N/A').replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" rel="noopener noreferrer" class="text-purple-400 hover:text-purple-300 underline">$1</a>'); videoDescription.innerHTML = dHtml; currentVideoDataForSave = { videoId: videoId, title: t, thumbnailUrl: th || 'https://placehold.co/60x34/0f0f1a/7c5cff?text=Thumb', channelTitle: c }; addRecentlyViewed({ videoId: videoId, title: t, thumbnailUrl: th || 'https://placehold.co/320x180/0f0f1a/7c5cff?text=No+Thumb', channelTitle: c, timestamp: Date.now() }); } else { videoTitle.textContent = 'Gagal Load'; videoUploader.textContent = ''; videoStats.textContent = ''; videoDescription.textContent = 'Video tak ditemukan.'; } }
        async function searchVideos(query, pageToken = null) { if (isLoadingSearch) return; isLoadingSearch = true; if (!pageToken) { searchResultsGrid.innerHTML = ''; searchNoResults.classList.add('hidden'); window.scrollTo(0, 0); } searchLoadingIndicator.classList.remove('hidden'); const params = { part: 'snippet', q: query, type: 'video', maxResults: SEARCH_MAX_RESULTS, pageToken: pageToken }; console.log(`Searching (token: ${pageToken})...`); const data = await fetchFromYouTubeAPI('/search', params); searchLoadingIndicator.classList.add('hidden'); if (data && data.items && Array.isArray(data.items)) { if (data.items.length === 0 && !pageToken) { searchNoResults.classList.remove('hidden'); } else if (data.items.length > 0) { searchNoResults.classList.add('hidden'); data.items.forEach(i => searchResultsGrid.appendChild(createVideoCardFromSearch(i))); } currentSearchPageToken = data.nextPageToken; if (!currentSearchPageToken) console.log("End of search results."); } else if (!pageToken) { searchResultsGrid.innerHTML = '<p class="text-center text-red-400 col-span-full py-5">Gagal cari.</p>'; searchNoResults.classList.add('hidden'); currentSearchPageToken = null; } isLoadingSearch = false; }

        // --- UI Functions ---
        // (createVideoCard, createVideoCardFromSearch, createRecentlyViewedCard, createPlaylistItem, createPlaylistVideoCard remain the same)
        function createVideoCard(videoData) { const card = document.createElement('div'); card.className = 'video-card glassmorphism overflow-hidden shadow-lg cursor-pointer flex flex-col h-full rounded-lg border border-purple-900/20 min-h-[250px] sm:min-h-[280px]'; const videoId = videoData.id; const snippet = videoData.snippet; const stats = videoData.statistics; const contentDetails = videoData.contentDetails; const title = snippet.title || 'Judul Tidak Tersedia'; const uploaderName = snippet.channelTitle || 'Channel Misterius'; const thumbnailUrl = snippet.thumbnails?.medium?.url || snippet.thumbnails?.default?.url || 'https://placehold.co/320x180/0f0f1a/7c5cff?text=No+Thumb'; const viewsText = stats?.viewCount ? formatViews(stats.viewCount) : 'N/A'; const uploadedText = snippet.publishedAt ? timeAgo(snippet.publishedAt) : 'Beberapa waktu lalu'; const durationText = contentDetails?.duration ? formatISO8601Duration(contentDetails.duration) : ''; card.onclick = () => navigateTo('watch', videoId); card.innerHTML = ` <div class="relative aspect-video bg-black/30"> <img src="${thumbnailUrl}" alt="Thumbnail for ${title}" class="w-full h-full object-cover" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/320x180/0f0f1a/7c5cff?text=Error';"> ${durationText ? `<span class="absolute bottom-1 right-1 bg-black/70 text-white text-xs px-1.5 py-0.5 rounded">${durationText}</span>` : ''} </div> <div class="p-3 flex flex-col flex-grow"> <h3 class="font-semibold text-sm mb-1 text-white line-clamp-2" title="${title}">${title}</h3> <p class="text-xs text-purple-300 mb-1 line-clamp-1" title="${uploaderName}">${uploaderName}</p> <p class="text-xs text-gray-400 mt-auto pt-1">${viewsText} views ‚Ä¢ ${uploadedText}</p> </div>`; return card; }
        function createVideoCardFromSearch(searchItem) { const card = document.createElement('div'); card.className = 'video-card glassmorphism overflow-hidden shadow-lg cursor-pointer flex flex-col h-full rounded-lg border border-purple-900/20 min-h-[250px] sm:min-h-[280px]'; const videoId = searchItem.id?.videoId; const snippet = searchItem.snippet; if (!videoId) { console.warn("Search item missing videoId:", searchItem); return document.createDocumentFragment(); } const title = snippet.title || 'Judul Tidak Tersedia'; const uploaderName = snippet.channelTitle || 'Channel Misterius'; const thumbnailUrl = snippet.thumbnails?.medium?.url || snippet.thumbnails?.default?.url || 'https://placehold.co/320x180/0f0f1a/7c5cff?text=No+Thumb'; const uploadedText = snippet.publishedAt ? timeAgo(snippet.publishedAt) : 'Beberapa waktu lalu'; card.onclick = () => navigateTo('watch', videoId); card.innerHTML = ` <div class="relative aspect-video bg-black/30"> <img src="${thumbnailUrl}" alt="Thumbnail for ${title}" class="w-full h-full object-cover" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/320x180/0f0f1a/7c5cff?text=Error';"> </div> <div class="p-3 flex flex-col flex-grow"> <h3 class="font-semibold text-sm mb-1 text-white line-clamp-2" title="${title}">${title}</h3> <p class="text-xs text-purple-300 mb-1 line-clamp-1" title="${uploaderName}">${uploaderName}</p> <p class="text-xs text-gray-400 mt-auto pt-1">${uploadedText}</p> </div>`; return card; }
        function createRecentlyViewedCard(videoData) { const card = document.createElement('div'); card.className = 'video-card glassmorphism overflow-hidden shadow-lg cursor-pointer flex flex-col h-full rounded-lg border border-purple-900/20 min-h-[250px] sm:min-h-[280px]'; const { videoId, title, thumbnailUrl, channelTitle, timestamp } = videoData; const viewedText = timestamp ? timeAgo(timestamp) : 'Beberapa waktu lalu'; card.onclick = () => { navigateTo('watch', videoId); }; card.innerHTML = ` <div class="relative aspect-video bg-black/30"> <img src="${thumbnailUrl}" alt="Thumbnail for ${title}" class="w-full h-full object-cover" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/320x180/0f0f1a/7c5cff?text=Error';"> </div> <div class="p-3 flex flex-col flex-grow"> <h3 class="font-semibold text-sm mb-1 text-white line-clamp-2" title="${title}">${title}</h3> <p class="text-xs text-purple-300 mb-1 line-clamp-1" title="${channelTitle}">${channelTitle}</p> <p class="text-xs text-gray-400 mt-auto pt-1">Dilihat: ${viewedText}</p> </div>`; return card; }
        function createPlaylistItem(playlist) { const item = document.createElement('div'); item.className = 'playlist-item glassmorphism p-4 rounded-lg flex justify-between items-center transition duration-200'; const videoCount = playlist.videos?.length || 0; item.innerHTML = ` <div class="flex-1 mr-4 cursor-pointer" onclick="navigateTo('playlist-detail', '${playlist.id}')"> <h4 class="font-semibold text-white mb-1 line-clamp-1">${playlist.name}</h4> <p class="text-xs text-gray-400">${videoCount} video</p> </div> <div class="flex space-x-2 flex-shrink-0"> <button onclick="openRenamePlaylistModal('${playlist.id}', '${escapeSingleQuotes(playlist.name)}')" class="p-1.5 rounded-md bg-yellow-600/30 hover:bg-yellow-500/40 text-yellow-300 transition duration-200" title="Ubah Nama"> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"> <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path></svg> </button> <button onclick="deletePlaylist('${playlist.id}')" class="p-1.5 rounded-md bg-red-600/30 hover:bg-red-500/40 text-red-300 transition duration-200" title="Hapus Playlist"> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 000-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg> </button> </div>`; return item; }
        function createPlaylistVideoCard(videoData, playlistId) { const card = document.createElement('div'); card.className = 'video-card glassmorphism overflow-hidden shadow-lg flex flex-col h-full rounded-lg border border-purple-900/20 min-h-[250px] sm:min-h-[280px] relative group'; const { videoId, title, thumbnailUrl, channelTitle, addedAt } = videoData; const addedText = addedAt ? `Ditambahkan: ${timeAgo(addedAt)}` : ''; const contentDiv = document.createElement('div'); contentDiv.className = 'cursor-pointer flex flex-col flex-grow'; contentDiv.onclick = () => navigateTo('watch', videoId); contentDiv.innerHTML = ` <div class="relative aspect-video bg-black/30"> <img src="${thumbnailUrl}" alt="Thumbnail for ${title}" class="w-full h-full object-cover" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/320x180/0f0f1a/7c5cff?text=Error';"> </div> <div class="p-3 flex flex-col flex-grow"> <h3 class="font-semibold text-sm mb-1 text-white line-clamp-2" title="${title}">${title}</h3> <p class="text-xs text-purple-300 mb-1 line-clamp-1" title="${channelTitle}">${channelTitle}</p> <p class="text-xs text-gray-400 mt-auto pt-1">${addedText}</p> </div>`; const removeButton = document.createElement('button'); removeButton.className = 'absolute top-2 right-2 p-1 rounded-full bg-red-600/70 hover:bg-red-500/90 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10'; removeButton.title = 'Hapus dari Playlist Ini'; removeButton.onclick = (e) => { e.stopPropagation(); removeVideoFromPlaylist(playlistId, videoId); }; removeButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>`; card.appendChild(contentDiv); card.appendChild(removeButton); return card; }


        // --- Modal Functions ---
        // (Unchanged from previous version)
        function openSaveVideoModal() { if (!currentVideoDataForSave) { showError("Data video belum siap."); return; } console.log("Opening save modal:", currentVideoDataForSave.videoId); saveModalThumbnail.src = currentVideoDataForSave.thumbnailUrl; saveModalTitle.textContent = currentVideoDataForSave.title; saveModalChannel.textContent = currentVideoDataForSave.channelTitle; const p = getPlaylists(); const arr = Object.values(p).sort((a, b) => b.createdAt - a.createdAt); saveModalPlaylistList.innerHTML = ''; if (arr.length === 0) { saveModalPlaylistList.innerHTML = '<p class="text-xs text-gray-400">Belum ada playlist.</p>'; } else { arr.forEach(i => { const isChecked = i.videos.some(v => v.videoId === currentVideoDataForSave.videoId); const div = document.createElement('div'); div.className = 'flex items-center'; div.innerHTML = ` <input type="checkbox" id="pl-check-${i.id}" name="playlistSelection" value="${i.id}" class="mr-2 h-4 w-4 rounded text-purple-500 focus:ring-purple-400 border-gray-600 bg-gray-700" ${isChecked ? 'checked disabled' : ''}> <label for="pl-check-${i.id}" class="text-sm ${isChecked ? 'text-gray-500' : 'text-gray-200'}">${i.name} ${isChecked ? '(sudah ada)' : ''}</label>`; saveModalPlaylistList.appendChild(div); }); } newPlaylistNameModalInput.value = ''; saveVideoModal.classList.remove('hidden'); }
        function closeSaveVideoModal() { saveVideoModal.classList.add('hidden'); }
        function createNewPlaylistFromModal() { const name = newPlaylistNameModalInput.value.trim(); if (name) { const id = createPlaylist(name); if (id) { openSaveVideoModal(); setTimeout(() => { const cb = document.getElementById(`pl-check-${id}`); if (cb) cb.checked = true; }, 50); } newPlaylistNameModalInput.value = ''; } else { showError("Masukkan nama playlist!"); } }
        saveVideoForm.addEventListener('submit', (e) => { e.preventDefault(); const sel = Array.from(e.target.elements.playlistSelection).filter(cb => cb.checked && !cb.disabled).map(cb => cb.value); if (sel.length > 0 && currentVideoDataForSave) { addVideoToPlaylists(sel, currentVideoDataForSave); } else if (sel.length === 0) { showError("Pilih playlist."); } });
        function openCreatePlaylistModal() { newPlaylistNameMainInput.value = ''; createPlaylistModal.classList.remove('hidden'); newPlaylistNameMainInput.focus(); }
        function closeCreatePlaylistModal() { createPlaylistModal.classList.add('hidden'); }
        createPlaylistForm.addEventListener('submit', (e) => { e.preventDefault(); const name = newPlaylistNameMainInput.value.trim(); if (name) { const success = createPlaylist(name); if (success) { closeCreatePlaylistModal(); loadPlaylists(); showSuccessMessage(`Playlist "${name}" dibuat! üéâ`); } } });
        function openRenamePlaylistModal(id, name) { renamePlaylistIdInput.value = id; renamePlaylistNameInput.value = name; renamePlaylistModal.classList.remove('hidden'); renamePlaylistNameInput.focus(); }
        function closeRenamePlaylistModal() { renamePlaylistModal.classList.add('hidden'); }
        renamePlaylistForm.addEventListener('submit', (e) => { e.preventDefault(); const id = renamePlaylistIdInput.value; const name = renamePlaylistNameInput.value.trim(); if (id && name) { const success = renamePlaylist(id, name); if (success) { closeRenamePlaylistModal(); loadPlaylists(); if (currentView === 'playlist-detail' && currentPlaylistId === id) loadPlaylistDetails(id); showSuccessMessage("Nama playlist diubah! üëç"); } } });


        // --- Update View logic ---
        // (Unchanged from previous version)
        function updateView() { console.log(`Updating view: ${currentView}, Playlist: ${currentPlaylistId}`); trendingView.classList.add('hidden'); watchView.classList.add('hidden'); searchView.classList.add('hidden'); aboutView.classList.add('hidden'); recentlyViewedView.classList.add('hidden'); playlistsView.classList.add('hidden'); playlistDetailView.classList.add('hidden'); if (currentView !== 'watch' && ytPlayer && typeof ytPlayer.stopVideo === 'function') { try { const state = ytPlayer.getPlayerState(); if (state === 1 || state === 2 || state === 3) ytPlayer.stopVideo(); } catch(e) { console.warn("Stop player error:", e); } } switch (currentView) { case 'home': trendingView.classList.remove('hidden'); loadTrendingVideos(); break; case 'watch': watchView.classList.remove('hidden'); if (currentVideoId) { loadVideoDetails(currentVideoId); loadVideoIntoPlayer(currentVideoId); } break; case 'search': searchView.classList.remove('hidden'); searchQueryDisplay.textContent = currentSearchQuery; if (searchResultsGrid.innerHTML === '' && !isLoadingSearch && currentSearchQuery) searchVideos(currentSearchQuery); break; case 'recently-viewed': recentlyViewedView.classList.remove('hidden'); loadRecentlyViewed(); break; case 'playlists': playlistsView.classList.remove('hidden'); loadPlaylists(); break; case 'playlist-detail': playlistDetailView.classList.remove('hidden'); if (currentPlaylistId) loadPlaylistDetails(currentPlaylistId); else navigateTo('playlists'); break; case 'about': aboutView.classList.remove('hidden'); hideLoading(); break; } if (currentView !== 'search' || currentSearchPageToken === null) window.scrollTo(0, 0); }

        // --- Navigation function ---
        // (Unchanged from previous version)
        function navigateTo(view, param = null) { console.log(`Navigating to: ${view}, Param: ${param}`); let hash = `#${view}`; if (view === 'watch' && param) hash += `?v=${param}`; else if (view === 'search' && param) hash += `?q=${encodeURIComponent(param)}`; else if (view === 'playlist-detail' && param) hash += `?id=${param}`; else if (view === 'home') hash = '#'; if (window.location.hash !== hash) window.location.hash = hash; else { console.log("Hash same, manual trigger."); handleHashChange(true); } }

        // --- Hash change handler ---
        // (Unchanged from previous version)
        function handleHashChange(isManual = false) { console.log(`Hash change. Hash: ${window.location.hash}, Manual: ${isManual}`); const hash = window.location.hash; let view = 'home'; let param = null; if (hash.startsWith('#watch?v=')) { view = 'watch'; param = hash.substring(9); } else if (hash.startsWith('#search?q=')) { view = 'search'; param = decodeURIComponent(hash.substring(10)); } else if (hash.startsWith('#playlist-detail?id=')) { view = 'playlist-detail'; param = hash.substring(20); } else if (hash === '#recently-viewed') view = 'recently-viewed'; else if (hash === '#playlists') view = 'playlists'; else if (hash === '#about') view = 'about'; else if (hash === '#' || hash === '') view = 'home'; console.log(`Determined view: ${view}, Param: ${param}`); const prevQuery = currentSearchQuery; const prevView = currentView; currentView = view; currentVideoId = (view === 'watch') ? param : null; currentPlaylistId = (view === 'playlist-detail') ? param : null; currentSearchQuery = (view === 'search') ? param : ''; const newSearch = view === 'search' && (currentSearchQuery !== prevQuery || prevView !== 'search'); if (newSearch) { console.log("New search, reset state."); currentSearchPageToken = null; isLoadingSearch = false; searchResultsGrid.innerHTML = ''; } updateView(); if (isManual && view === 'home') { console.log("Manual home refresh."); cachedTrendingData = null; currentTrendingPageToken = null; loadTrendingVideos(null, true); } }


        // --- Utility Functions ---
        // (formatViews, timeAgo, formatISO8601Duration, showLoading, hideLoading, toggleSidebar, closeSidebar, escapeSingleQuotes remain the same)
        function formatViews(v) { if (v === undefined || v === null || v < 0) return 'N/A'; if (v === 0) return 'No'; v = parseInt(v, 10); if (isNaN(v)) return 'N/A'; if (v >= 1e9) return (v / 1e9).toFixed(1).replace('.0', '') + ' Miliar'; if (v >= 1e6) return (v / 1e6).toFixed(1).replace('.0', '') + ' Juta'; if (v >= 1e3) return (v / 1e3).toFixed(1).replace('.0', '') + ' Ribu'; return v.toString(); }
        function timeAgo(ts) { if (!ts) return '?'; const d = new Date(ts); if (isNaN(d.getTime())) return '?'; const n = new Date(); const s = Math.floor((n - d) / 1000); if (s < 5) return "Baru saja"; let i = Math.floor(s / 31536000); if (i >= 1) return i + " thn lalu"; i = Math.floor(s / 2592000); if (i >= 1) return i + " bln lalu"; i = Math.floor(s / 86400); if (i >= 1) return i + " hr lalu"; i = Math.floor(s / 3600); if (i >= 1) return i + " jam lalu"; i = Math.floor(s / 60); if (i >= 1) return i + " mnt lalu"; return Math.floor(s) + " dtk lalu"; }
        function formatISO8601Duration(d) { if (!d) return ''; const m = d.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/); if (!m) return ''; const h = parseInt(m[1] || 0); const min = parseInt(m[2] || 0); const s = parseInt(m[3] || 0); let r = ''; if (h > 0) { r += h + ':'; r += String(min).padStart(2, '0') + ':'; } else r += min + ':'; r += String(s).padStart(2, '0'); return r; }
        function showLoading() { loadingIndicator.classList.remove('hidden'); }
        function hideLoading() { setTimeout(() => { loadingIndicator.classList.add('hidden'); }, 50); }
        function toggleSidebar() { const isOpen = !mobileSidebar.classList.contains('translate-x-full'); if (isOpen) closeSidebar(); else { mobileSidebar.classList.remove('translate-x-full'); sidebarOverlay.classList.remove('hidden'); } }
        function closeSidebar() { mobileSidebar.classList.add('translate-x-full'); sidebarOverlay.classList.add('hidden'); }
        function escapeSingleQuotes(str) { return str.replace(/'/g, "\\'"); }

        /** Displays a notification message (error or success). (UPDATED) */
        function showNotification(message, type = 'error', duration = 5000) {
            console.log(`Notification (${type}):`, message);
            notificationText.textContent = message;

            // Clear previous styles
            notificationMessage.classList.remove('bg-red-600/80', 'border-red-800', 'bg-green-600/80', 'border-green-800');

            if (type === 'success') {
                notificationTitle.textContent = 'Sukses! ‚ú®'; // Success title
                notificationMessage.classList.add('bg-green-600/80', 'border-green-800');
            } else { // Default to error
                notificationTitle.textContent = 'Waduh! üò•'; // Error title
                notificationMessage.classList.add('bg-red-600/80', 'border-red-800');
            }

            notificationMessage.classList.remove('hidden');
            // Auto-hide after duration
            setTimeout(() => {
                notificationMessage.classList.add('hidden');
            }, duration);
        }

        // Replace old showError and showSuccessMessage with the unified function
        function showError(message) {
            showNotification(message, 'error', 7000); // Longer duration for errors
        }
        function showSuccessMessage(message) {
            showNotification(message, 'success', 4000); // Shorter duration for success
        }


        // --- Event Listeners ---
        // (Unchanged from previous version)
        window.addEventListener('hashchange', () => handleHashChange(false));
        document.addEventListener('DOMContentLoaded', () => { console.log("DOM Loaded. Init VisionTube v2..."); handleHashChange(false); mobileMenuButton.addEventListener('click', toggleSidebar); sidebarOverlay.addEventListener('click', closeSidebar); searchFormDesktop.addEventListener('submit', handleSearchSubmit); searchFormMobile.addEventListener('submit', handleSearchSubmit); window.addEventListener('scroll', handleScroll); trendingLoadMoreButton.addEventListener('click', () => { if (currentTrendingPageToken && !isLoadingTrending) loadTrendingVideos(currentTrendingPageToken); }); document.addEventListener('fullscreenchange', handleFullscreenChange); document.addEventListener('mozfullscreenchange', handleFullscreenChange); document.addEventListener('webkitfullscreenchange', handleFullscreenChange); document.addEventListener('msfullscreenchange', handleFullscreenChange);

            const desktopSidebarContainer = document.getElementById('desktop-sidebar-container');
            const desktopSidebarToggleButton = document.getElementById('desktop-sidebar-toggle-button');
            const desktopNavContainer = document.getElementById('desktop-nav-container');

            function toggleDesktopSidebar() {
                desktopSidebarContainer.classList.toggle('open');
            }

            // Kita langsung pindahin semua link navigasi ke sidebar desktop saat halaman diload
            const navLinks = desktopNavContainer.querySelector('nav').innerHTML;
            desktopSidebarContainer.querySelector('nav').innerHTML = navLinks;
            // Kosongkan navbar utama biar tombol toggle aja yang keliatan
            desktopNavContainer.querySelector('nav').innerHTML = '';

            desktopSidebarToggleButton.addEventListener('click', toggleDesktopSidebar);

        });
        function handleSearchSubmit(e) { e.preventDefault(); const input = e.target.id === 'search-form-mobile' ? searchInputMobile : searchInputDesktop; const q = input.value.trim(); if (q) { navigateTo('search', q); input.value = ''; if (e.target.id === 'search-form-mobile') closeSidebar(); } }
        function handleScroll() { if (currentView === 'search' && !isLoadingSearch && currentSearchPageToken) { const { scrollTop, scrollHeight, clientHeight } = document.documentElement; if (scrollTop + clientHeight >= scrollHeight - 600) { console.log("Scroll load more search..."); searchVideos(currentSearchQuery, currentSearchPageToken); } } }

        // --- Fullscreen Functions ---
        // (Unchanged from previous version)
        function handleFullscreenChange() { isFullscreen = !!(document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement); console.log("Fullscreen:", isFullscreen); youtubePlayerContainer.classList.toggle('fullscreen', isFullscreen); if (!isFullscreen) { try { if (screen.orientation && screen.orientation.unlock) screen.orientation.unlock(); } catch (e) { console.warn("Orientation unlock error:", e); } } }

    </script>

</body>
</html>
